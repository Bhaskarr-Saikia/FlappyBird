<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Flappy Bird Custom</title>
<style>
    body {
        margin: 0;
        background: #222;
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
        user-select: none;
    }

    #gameContainer {
        position: relative;
    }

    #gameCanvas {
        background: skyblue;
        border: 3px solid #000;
        border-radius: 10px;
    }

    #scoreDisplay {
        position: absolute;
        top: 10px;
        left: 10px;
        color: #fff;
        font-size: 26px;
        font-weight: bold;
        text-shadow: 2px 2px 4px #000;
    }

    #hint {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #fff;
        font-size: 20px;
        background: rgba(0,0,0,0.4);
        padding: 10px 20px;
        border-radius: 8px;
    }

    #overlay {
        display: none;
        position: absolute;
        inset: 0;
        background: rgba(0,0,0,0.6);
        color: white;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        font-size: 32px;
    }

    #controls {
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
        width: 100%;
        padding: 5px;
    }

    button {
        padding: 10px 18px;
        font-size: 16px;
        border: none;
        background: #ffcc00;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
    }

    button:hover {
        background: #e6b800;
    }

    #imgControls {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 10px;
    }
</style>
</head>
<body>

<div id="gameContainer">
    <canvas id="gameCanvas" width="450" height="600"></canvas>
    <div id="scoreDisplay">Score: 0</div>
    <div id="hint">Click or press SPACE to Start & Flap</div>

    <div id="overlay">
        <div id="gameOverTitle">GAME OVER</div>
        <div id="finalScore"></div>
        <button id="playAgainBtn">Play Again</button>
    </div>

    <div id="controls">
        <button id="startBtn">Start</button>
        <button id="pauseBtn">Pause</button>
        <button id="restartBtn">Restart</button>
    </div>

    <div id="imgControls">
        <input type="file" id="imgfile" accept="image/*">
        <button id="useDefault">Use Default</button>
    </div>
</div>


<script>
/* === FLAPPY BIRD GAME WITH GRADUAL SPEED INCREASE === */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const scoreDisplay = document.getElementById('scoreDisplay');
const overlay = document.getElementById('overlay');
const finalScoreEl = document.getElementById('finalScore');
const hintEl = document.getElementById('hint');

const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const restartBtn = document.getElementById('restartBtn');
const playAgainBtn = document.getElementById('playAgainBtn');
const imgFile = document.getElementById('imgfile');
const useDefaultBtn = document.getElementById('useDefault');

const W = canvas.width;
const H = canvas.height;

let birdImg = new Image();
let running = false, paused = false, gameOver = false;

const GRAVITY = 0.55;
const FLAP_VELOCITY = -9;
let speed = 1.4;                        // slow start
let SPEED_INCREASE_RATE = 0.0006;       // gradual gain

const bird = {
    x: 80,
    y: H / 2,
    w: 48,
    h: 36,
    vy: 0,
    rotation: 0
};

let pipes = [];
const PIPE_WIDTH = 52;
const PIPE_GAP = 150;
let frame = 0;
let spawnInterval = 100;
let score = 0;

function createDefaultBirdImage() {
    const s = 64;
    const off = document.createElement('canvas');
    off.width = s; 
    off.height = s;
    const c = off.getContext('2d');

    c.fillStyle = '#ffcc00';
    c.beginPath();
    c.ellipse(s*0.45, s*0.45, s*0.38, s*0.32, 0, 0, Math.PI*2);
    c.fill();

    c.fillStyle = '#000';
    c.beginPath();
    c.arc(s*0.62, s*0.35, 4, 0, Math.PI*2);
    c.fill();

    c.fillStyle = '#ff7a00';
    c.beginPath();
    c.moveTo(s*0.7, s*0.45);
    c.lineTo(s*0.9, s*0.5);
    c.lineTo(s*0.7, s*0.55);
    c.closePath();
    c.fill();

    return off;
}
birdImg = createDefaultBirdImage();

function resetGame() {
    pipes = [];
    frame = 0;
    score = 0;
    speed = 1.4;

    bird.y = H / 2;
    bird.vy = 0;

    running = false;
    paused = false;
    gameOver = false;

    overlay.style.display = "none";
    scoreDisplay.textContent = "Score: 0";
    hintEl.style.display = "block";
}

function spawnPipe() {
    const margin = 40;
    const minGapY = margin + PIPE_GAP / 2;
    const maxGapY = H - margin - PIPE_GAP / 2 - 80;

    const gapY = Math.floor(Math.random() * (maxGapY - minGapY + 1) + minGapY);

    pipes.push({
        x: W + 10,
        w: PIPE_WIDTH,
        gapY,
        gapH: PIPE_GAP,
        scored: false
    });
}

function drawBackground() {
    ctx.fillStyle = '#cfa86a';
    ctx.fillRect(0, H - 70, W, 70);

    ctx.fillStyle = '#b88e53';
    ctx.fillRect(0, H - 20, W, 20);
}

function drawPipes() {
    ctx.save();
    for (const p of pipes) {
        ctx.fillStyle = '#2f8a2f';
        ctx.fillRect(p.x, 0, p.w, p.gapY - p.gapH/2);
        ctx.fillRect(p.x, p.gapY + p.gapH/2, p.w, H - (p.gapY + p.gapH/2) - 70);
    }
    ctx.restore();
}

function drawBird() {
    ctx.save();
    ctx.translate(bird.x, bird.y);
    ctx.rotate(bird.rotation);
    ctx.drawImage(birdImg, -bird.w / 2, -bird.h / 2, bird.w, bird.h);
    ctx.restore();
}

function checkCollisions() {
    const bx = bird.x - bird.w/2;
    const by = bird.y - bird.h/2;
    const bw = bird.w;
    const bh = bird.h;

    if (bird.y + bird.h / 2 >= H - 70) return true;
    if (bird.y - bird.h / 2 <= 0) return true;

    for (const p of pipes) {
        const topH = p.gapY - p.gapH/2;
        const bottomY = p.gapY + p.gapH/2;

        if (bx < p.x + p.w && bx + bw > p.x && by < topH) return true;
        if (bx < p.x + p.w && bx + bw > p.x && by + bh > bottomY) return true;
    }
    return false;
}

function gameOverNow() {
    gameOver = true;
    running = false;

    overlay.style.display = "flex";
    finalScoreEl.textContent = "Your score: " + score;
    hintEl.style.display = "none";
}

function update() {
    if (!running || paused || gameOver) return;
    frame++;

    bird.vy += GRAVITY;
    bird.y += bird.vy;

    bird.rotation = Math.min(Math.PI/6, Math.max(-Math.PI/2, bird.vy * 0.04));

    for (const p of pipes) {
        p.x -= speed;

        if (!p.scored && p.x + p.w < bird.x - bird.w/2) {
            p.scored = true;
            score++;
            scoreDisplay.textContent = "Score: " + score;
        }
    }

    pipes = pipes.filter(p => p.x + p.w > -50);

    if (frame % spawnInterval === 0) spawnPipe();

    // gradual speed increase
    speed += SPEED_INCREASE_RATE;

    if (checkCollisions()) gameOverNow();
}

function render() {
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = "#9fe0ff";
    ctx.fillRect(0, 0, W, H);

    drawPipes();
    drawBird();
    drawBackground();
}

function tick() {
    if (!paused && running && !gameOver) {
        update();
        render();
    } else {
        render();
    }
    requestAnimationFrame(tick);
}

function flap() {
    if (gameOver) return;
    if (!running) startGame();
    bird.vy = FLAP_VELOCITY;
    hintEl.style.display = "none";
}

function startGame() {
    if (gameOver) resetGame();
    running = true;
    paused = false;
    if (pipes.length === 0) spawnPipe();
}

function togglePause() {
    if (!running) return;
    paused = !paused;
    pauseBtn.textContent = paused ? "Resume" : "Pause";
}

function restart() {
    resetGame();
    startGame();
}

document.addEventListener('keydown', e => {
    if (e.code === 'Space') {
        e.preventDefault();
        flap();
    }
});
canvas.addEventListener('mousedown', flap);
canvas.addEventListener('touchstart', flap, { passive: false });

startBtn.addEventListener('click', startGame);
pauseBtn.addEventListener('click', togglePause);
restartBtn.addEventListener('click', restart);
playAgainBtn.addEventListener('click', restart);

// Upload custom bird image
imgFile.addEventListener("change", ev => {
    const f = ev.target.files[0];
    if (!f) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        const im = new Image();
        im.onload = function() {
            birdImg = im;
            const ratio = im.width / im.height;

            bird.h = 40;
            bird.w = bird.h * ratio;
            hintEl.textContent = "Custom image loaded — press Start";
        };
        im.src = e.target.result;
    };
    reader.readAsDataURL(f);
});

// Default Bird
useDefaultBtn.addEventListener("click", () => {
    birdImg = createDefaultBirdImage();
    bird.w = 48; 
    bird.h = 36;
    hintEl.textContent = "Default bird selected — press Start";
});

resetGame();
requestAnimationFrame(tick);

</script>

</body>
</html>
